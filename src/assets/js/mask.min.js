function Mask(t){this.patternImage=new Image,this.patternImage.src=t.patternImageSrc,this.backgroundImageLoaded=!1,this.patternImageLoaded=!1;var a=this;this.patternImage.onload=function(){a.patternImageLoaded=!0,a.draw()}}function updateCanvasDpi(t,a){if(devicePixelRatio=window.devicePixelRatio||1,backingStoreRatio=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,ratio=devicePixelRatio/backingStoreRatio,"undefined"==typeof auto&&(auto=!0),auto&&devicePixelRatio!==backingStoreRatio){var e=a.width,i=a.height;a.width=e*ratio,a.height=i*ratio,a.style.width=e+"px",a.style.height=i+"px",t.scale(ratio,ratio)}}Mask.prototype.setCanvas=function(t){this.canvas=t},Mask.prototype.setBackgroundImage=function(t){this.backgroundImage=new Image,this.backgroundImage.src=t;var a=this;this.backgroundImage.onload=function(){a.backgroundImageLoaded=!0,a.draw()}},Mask.prototype.setMask=function(t){this.mask=t,this.maskColumns=t[0].length,this.maskRows=t.length},Mask.prototype.getMask=function(){return this.mask},Mask.prototype.updateResize=function(){updateCanvasDpi(this.canvas.getContext("2d"),this.canvas)},Mask.prototype.getXFromMouseEvent=function(t){var a=t instanceof MouseEvent?t.offsetX:t.targetTouches[0].pageX,e=Math.min(Math.max(a,0),this.canvas.clientWidth),i=Math.floor(e/this.canvas.clientWidth*this.maskColumns);return i=Math.min(Math.max(i,0),this.maskColumns-1)},Mask.prototype.getYFromMouseEvent=function(t){var a=t instanceof MouseEvent?t.offsetY:t.targetTouches[0].pageY,e=Math.min(Math.max(a,0),this.canvas.clientHeight),i=Math.floor(e/this.canvas.clientHeight*this.maskRows);return i=Math.min(Math.max(i,0),this.maskRows-1)},Mask.prototype.onTapDown=function(t){var a=this.getXFromMouseEvent(t),e=this.getYFromMouseEvent(t);this.mask[e][a]=!this.mask[e][a],this.isEnableMask=this.mask[e][a],this.draw()},Mask.prototype.onTapMove=function(t){var a=this.getXFromMouseEvent(t),e=this.getYFromMouseEvent(t);this.mask[e][a]=this.isEnableMask,this.draw()},Mask.prototype.draw=function(){var t=this.canvas.getContext("2d");dimensions={top:0,left:0,width:this.canvas.clientWidth,height:this.canvas.clientHeight},t.fillStyle="#212121",t.fillRect(0,0,dimensions.width,dimensions.height),this.backgroundImageLoaded&&t.drawImage(this.backgroundImage,0,0,this.canvas.clientWidth,this.canvas.clientHeight);let a=this.canvas.clientWidth/this.maskColumns,e=this.canvas.clientHeight/this.maskRows;t.strokeStyle="#8A2E2E",t.beginPath();for(var i=1;i<this.canvas.clientWidth;i++)t.moveTo(i*a,0),t.lineTo(i*a,this.canvas.clientHeight),t.moveTo(0,i*e),t.lineTo(this.canvas.clientWidth,i*e);if(t.stroke(),this.patternImageLoaded){var s=t.createPattern(this.patternImage,"repeat");if(t.fillStyle=s,this.mask)for(var o=0;o<this.mask.length;o++)for(var n=0;n<this.mask[o].length;n++)0==this.mask[o][n]&&t.rect(n*a,o*e,a,e);else console.error("Mask is empty!");t.fill()}};
